{"version":3,"sources":["webpack:///./src/modules/setting/setting.js","webpack:///./src/assets/css/setting/setting.css"],"names":[],"mappings":";;;;;0CAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,cAAa;AACb;AACA;;AAEA,UAAS;AACT;;;AAGA,MAAK;AACL;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;AACA,UAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA,cAAa;AACb;AACA;AACA,UAAS;AACT,MAAK;AACL;AACA;AACA;AACA;AACA,UAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA,cAAa;AACb;AACA;AACA,UAAS;AACT,MAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,cAAa;AACb;AACA;AACA,UAAS;AACT;AACA,MAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA,UAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA,oCAAmC,cAAc;AACjD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gCAA+B,iBAAiB;AAChD;AACA;AACA;;AAEA,cAAa;AACb;AACA;AACA;AACA,UAAS;AACT,MAAK;AACL;AACA;AACA;AACA;AACA;AACA,UAAS;AACT;AACA;AACA,gCAA+B,iBAAiB;AAChD;AACA;AACA;AACA,cAAa;AACb;AACA;AACA,UAAS;AACT,MAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;AACA;;AAEA,MAAK;AACL;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAS;AACT,MAAK;AACL;AACA;AACA;AACA;;AAEA;;AAEA,MAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAS;AACT,4CAA2C,iBAAiB;AAC5D;AACA;AACA;AACA;AACA;AACA,UAAS;AACT,MAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,MAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,UAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA,EAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA,EAAC,C;;;;;;;;ACtQD,0C","file":"js/20.chunk.cdcf4fcb.js","sourcesContent":["require('../../assets/css/setting/setting.css');\r\nvar host = require('../../config').requestHost();\r\nvar format = require('../../config').format;\r\nvar settingVm = avalon.define({\r\n    $id: 'setting',\r\n    message: '',\r\n    defaultData: {\r\n        industry: \"互联网全行业\",\r\n        sub_industry: '金融运营'\r\n    },\r\n    collectionList: [],\r\n    downloadList: [],\r\n    count: [],\r\n    noChecked: false,\r\n    downloadItem: '',\r\n    index: 0,\r\n    current: 1,\r\n    allSelect: function() {\r\n        var isChecked = $(this)[0].checked;\r\n        $('#collectTable').find('input[type=\"checkbox\"]').prop('checked', isChecked);\r\n        settingVm.noChecked = !isChecked;\r\n    },\r\n    childSelect: function() {\r\n        var isChecked = true;\r\n        var all = $('#collectTable').children('tbody').find('input[type=\"checkbox\"]');\r\n        all.each(function(i, el) {\r\n            if (!el.checked) {\r\n                $('#all').prop('checked', false);\r\n                isChecked = false;\r\n                return false;\r\n            } else {\r\n                settingVm.noChecked = false;\r\n            }\r\n\r\n        });\r\n        isChecked ? $('#all').prop('checked', true) : null;\r\n\r\n\r\n    },\r\n    selectItem: function(e, type) {\r\n        e.preventDefault();\r\n        var name = type === 1 ? 'industry' : 'sub_industry';\r\n        settingVm.defaultData[name] = $(this).text();\r\n    },\r\n    modifyIndustry: function(e) {\r\n        e.preventDefault();\r\n        $.post(host + '/user/modify/industry?' + new Date().getTime(), {\r\n            industry: settingVm.defaultData.industry\r\n        }, function(result) {\r\n            if (result.code === -10 || result.code === -11) {\r\n                avalon.vmodels.root.showMessage(result.msg);\r\n                avalon.router.go('login');\r\n            }\r\n            if (result.code === 0) {\r\n                avalon.vmodels.root.showMessage('默认行业修改成功!');\r\n            } else {\r\n                avalon.vmodels.root.showMessage(result.msg);\r\n            }\r\n        })\r\n    },\r\n    modifySubIndustry: function(e) {\r\n        e.preventDefault();\r\n        $.post(host + '/user/modify/subindustry?' + new Date().getTime(), {\r\n            sub_industry: settingVm.defaultData.sub_industry\r\n        }, function(result) {\r\n            if (result.code === -10 || result.code === -11) {\r\n                avalon.vmodels.root.showMessage(result.msg);\r\n                avalon.router.go('login');\r\n            }\r\n            if (result.code === 0) {\r\n                avalon.vmodels.root.showMessage('默认子行业修改成功!');\r\n            } else {\r\n                avalon.vmodels.root.showMessage(result.msg);\r\n            }\r\n        })\r\n    },\r\n    getDefaultIndustry: function() {\r\n        $.get(host + '/user/defualt_industry', function(result) {\r\n            if (result.code === -10 || result.code === -11) {\r\n                avalon.vmodels.root.showMessage(result.msg);\r\n                avalon.router.go('login');\r\n            }\r\n            if (result.code === 0) {\r\n                result.data.sub_industry = result.data.sub_industry || '金融运营';\r\n                result.data.industry = result.data.industry || '互联网全行业';\r\n                settingVm.defaultData = result.data;\r\n            } else {\r\n                avalon.vmodels.root.showMessage(result.msg);\r\n            }\r\n        })\r\n        this.getCollectionList(1);\r\n    },\r\n    //获取收藏列表\r\n    getCollectionList: function(page) {\r\n        avalon.vmodels.root.showLoading = true;\r\n        $.post(host + '/report/collect/list', {\r\n            page: page || 1,\r\n            pageSize: 10\r\n        }, function(data) {\r\n            if (data.code === -10 || data.code === -11) {\r\n                avalon.vmodels.root.showMessage(data.msg);\r\n                avalon.router.go('login');\r\n            }\r\n            if (data.code === 0) {\r\n                if (settingVm.index === 0) {\r\n                    var page = Math.ceil(Number(data.data.count) / 10);\r\n                    for (var i = 1; i < page + 1; i++) {\r\n                        settingVm.count.push(i);\r\n                    }\r\n                    settingVm.getDownloadList(1);\r\n                }\r\n                settingVm.current = data.data.page;\r\n                settingVm.index++;\r\n                var temp = data.data.data;\r\n                settingVm.collectionList = [];\r\n                for (var i = 0; i < temp.length; i++) {\r\n                    temp[i].collect_time = format(temp[i].collect_time, 'yyyy-MM-dd HH:mm:ss');\r\n                    settingVm.collectionList.push(temp[i]);\r\n                }\r\n\r\n            } else {\r\n                avalon.vmodels.root.showMessage(data.msg);\r\n            }\r\n            avalon.vmodels.root.showLoading = false;\r\n        })\r\n    },\r\n    //获取下载列表\r\n    getDownloadList: function(page) {\r\n        $.post(host + '/report/download/list', {\r\n            page: page || 1,\r\n            pageSize: 10\r\n        }, function(data) {\r\n            if (data.code === 0) {\r\n                var temp = data.data.data;\r\n                for (var i = 0; i < temp.length; i++) {\r\n                    temp[i].download_time = format(temp[i].download_time, 'yyyy-MM-dd HH:mm:ss');\r\n                }\r\n                settingVm.downloadList = temp;\r\n            } else {\r\n                avalon.vmodels.root.showMessage(data.msg);\r\n            }\r\n        })\r\n    },\r\n    //获取选中的信息\r\n    getCheckData: function(arg) {\r\n        var idArr = [],\r\n            dataIdArr = [],\r\n            item = $('#collectTable').children('tbody').find('input[type=\"checkbox\"]:checked');\r\n        if (item.length == 0) {\r\n            return false;\r\n        }\r\n        item.each(function(i, el) {\r\n            idArr.push($(el).attr('id'));\r\n            dataIdArr.push($(el).attr('data-id'));\r\n        });\r\n        switch (arg) {\r\n            case \"\":\r\n                return true;\r\n            case \"id\":\r\n                return idArr;\r\n            case \"data-id\":\r\n                return dataIdArr;\r\n        }\r\n    },\r\n    checkDelete: function() {\r\n        var _result = settingVm.getCheckData(\"\");\r\n        if (_result) {\r\n            $('#deleteItem').modal('show');\r\n        }\r\n\r\n    },\r\n    checkDownload: function() {\r\n        var _result = settingVm.getCheckData();\r\n        if (_result) {\r\n            $('#downloadItem').modal('show');\r\n        }\r\n    },\r\n    //删除收藏条目\r\n    deleteCollectionItem: function() {\r\n        var _result = settingVm.getCheckData(\"id\");\r\n        var bean = {\r\n            report_id: _result.join(\",\")\r\n        }\r\n        $.post(host + '/report/collect/del', bean, function(data) {\r\n            if (data.code === 0) {\r\n                $('#deleteItem').modal('hide');\r\n                avalon.vmodels.root.showMessage('删除成功！');\r\n                settingVm.count = [];\r\n                settingVm.getCollectionList(1);\r\n            }\r\n        })\r\n    },\r\n    //分享收藏条目\r\n    checkShare: function() {\r\n        var _result = settingVm.getCheckData(\"data-id\");\r\n        $(\"#shareImg\").attr(\"src\", host + '/report/share?data_ids=' + _result.join(\",\"));\r\n\r\n        $('#erweima').modal('show');\r\n\r\n    },\r\n    //下载收藏条目\r\n    DownloadItem: function() {\r\n        var arr = [];\r\n        var item = $('#collectTable').children('tbody').find('input[type=\"checkbox\"]:checked');\r\n        item.each(function(i, el) {\r\n            var temp = {\r\n                report_name: '',\r\n                data_id: '',\r\n                info_id: '',\r\n                type: $('input[name=\"format\"]:checked').val()\r\n            }\r\n            arr.push(temp);\r\n        });\r\n        $.post(host + '/report/download', { report_id: arr }, function(data) {\r\n            if (data.code === 0) {\r\n                $('#downloadItem').modal('hide');\r\n                avalon.vmodels.root.showMessage('删除成功！');\r\n                settingVm.collectionList.splice(settingVm.colletionItem, 1);\r\n            }\r\n        })\r\n    },\r\n    turnPage: function(page, e) {\r\n        e.preventDefault();\r\n        if ($(this).hasClass('active')) {\r\n            return false\r\n        }\r\n        $(this).addClass('active').siblings().removeClass('active');\r\n        settingVm.getCollectionList(page);\r\n\r\n    },\r\n    preAndBack: function(e, type) {\r\n        e.preventDefault();\r\n        var current = settingVm.current;\r\n\r\n        if (type === 'pre') {\r\n            if (parseInt(current) - 1 === 0) {\r\n                return false\r\n            }\r\n            settingVm.getCollectionList(current - 1);\r\n        } else {\r\n            if (parseInt(current) + 1 > settingVm.count.length) {\r\n                return false\r\n            }\r\n            settingVm.getCollectionList(current + 1);\r\n        }\r\n    }\r\n});\r\nmodule.exports = avalon.controller(function($ctrl) {\r\n    // 视图渲染后，意思是avalon.scan完成\r\n    $ctrl.$onRendered = function() {}\r\n        // 进入视图\r\n    $ctrl.$onEnter = function() {\r\n        settingVm.index = 0;\r\n        settingVm.count = [];\r\n        settingVm.getDefaultIndustry();\r\n\r\n    }\r\n\r\n    // 对应的视图销毁前\r\n    $ctrl.$onBeforeUnload = function() {}\r\n        // 指定一个avalon.scan视图的vmodels，vmodels = $ctrl.$vmodels.concact(DOM树上下文vmodels)\r\n    $ctrl.$vmodels = []\r\n})\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/modules/setting/setting.js\n// module id = 54\n// module chunks = 20","// removed by extract-text-webpack-plugin\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/assets/css/setting/setting.css\n// module id = 55\n// module chunks = 20"],"sourceRoot":""}